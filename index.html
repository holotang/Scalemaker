<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scale Matrix for Composers</title>
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; background: #f0f2f5; color: #333; margin: 0; padding: 0; line-height: 1.6; }
        header { background: #1a1a1a; color: white; padding: 1.5rem; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        h1 { margin: 0; font-size: 1.5rem; letter-spacing: 2px; }
        main { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        
        .controls { background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .flex-row { display: flex; align-items: center; gap: 20px; margin-bottom: 1rem; flex-wrap: wrap; }
        .root-key-area, .order-area { display: flex; align-items: center; gap: 10px; }
        label { font-weight: bold; font-size: 0.9rem; }
        
        .selector-area { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px; border-top: 1px solid #eee; padding-top: 15px; }
        .scale-checkbox { display: flex; align-items: center; gap: 5px; background: #f8f9fa; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; border: 1px solid #ddd; cursor: pointer; }
        
        .btn-group { margin-top: 5px; }
        button { padding: 4px 10px; font-size: 0.7rem; cursor: pointer; border-radius: 4px; border: 1px solid #ccc; background: #fff; }
        select { padding: 6px 10px; font-size: 0.95rem; border-radius: 6px; border: 1px solid #ccc; background: #fff; }

        table { width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-top: 1rem; }
        th { background: #333; color: white; padding: 12px; text-align: left; font-size: 0.8rem; text-transform: uppercase; }
        td { padding: 10px 12px; border-bottom: 1px solid #eee; font-size: 0.9rem; }
        .notes { font-family: 'Courier New', monospace; font-weight: bold; color: #e63946; font-size: 1.05rem; }
        .region { font-weight: bold; color: #2a9d8f; font-size: 0.8rem; }
        
        /* Âàá„ÇäÊõø„Åà„Çπ„Ç§„ÉÉ„ÉÅ„ÅÆÂº∑Ë™ø */
        .order-area select { border: 2px solid #2a9d8f; background: #f0fff0; }
        
        @media (max-width: 800px) { .notes { font-size: 0.9rem; white-space: normal; } }
    </style>
</head>
<body>

<header>
    <h1>üéº Scale Matrix</h1>
</header>

<main>
    <div class="controls">
        <div class="flex-row">
            <div class="root-key-area">
                <label for="keySelect">Root Key:</label>
                <select id="keySelect" onchange="update()"></select>
            </div>
            
            <div class="order-area">
                <label for="orderSelect">‰∏¶„Å≥È†Ü:</label>
                <select id="orderSelect" onchange="update()">
                    <option value="scale">Èü≥ÈöéÈ†Ü (C D E F...)</option>
                    <option value="tertial">3Â∫¶ÊßãÊàêÈ†Ü (C E G B...)</option>
                </select>
            </div>
        </div>
        
        <label style="font-size: 0.8rem; font-weight: bold; display: block; margin-bottom: 8px;">Ë°®Á§∫„Åô„Çã„Çπ„Ç±„Éº„É´„ÇíÈÅ∏Êäû:</label>
        <div id="checkboxContainer" class="selector-area"></div>
        <div class="btn-group">
            <button onclick="checkAll(true)">„Åô„Åπ„Å¶ÈÅ∏Êäû</button>
            <button onclick="checkAll(false)">„Åô„Åπ„Å¶Ëß£Èô§</button>
        </div>
    </div>

    <table id="scaleTable">
        <thead>
            <tr>
                <th>Èü≥Êï∞</th>
                <th>„Çπ„Ç±„Éº„É´Âêç</th>
                <th>ÊßãÊàêÈü≥</th>
                <th>‰∏ª„Å™Âú∞Âüü</th>
                <th>„Ç§„É°„Éº„Ç∏</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</main>

<script>
    const notesSharp = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
    const notesFlat  = ["C", "Db", "D", "Eb", "E", "F", "Gb", "G", "Ab", "A", "Bb", "B"];
    
    const scales = [
        { id: "ryukyu", n: 5, name: "ÁêâÁêÉÈü≥Èöé", intervals: [0, 4, 5, 7, 11], region: "Êó•Êú¨ (Ê≤ñÁ∏Ñ)", img: "Â§™ÈôΩ„ÉªÈñãÊîæÁöÑ", prefer: "sharp" },
        { id: "ritsu", n: 5, name: "ÂæãÊóãÊ≥ï", intervals: [0, 2, 5, 7, 9], region: "Êó•Êú¨ (ÈõÖÊ•Ω)", img: "ÈùôË¨ê„ÉªÈúß", prefer: "sharp" },
        { id: "in", n: 5, name: "Èô∞ÊóãÊ≥ï", intervals: [0, 1, 5, 7, 8], region: "Êó•Êú¨ (ÈÉΩÁØÄ)", img: "ÂìÄÊÑÅ„ÉªÈÅãÂëΩ", prefer: "flat" },
        { id: "china", n: 5, name: "‰∏≠ÂõΩÈü≥Èöé", intervals: [0, 2, 4, 7, 9], region: "‰∏≠ÂõΩ", img: "Â§ßÈô∏ÁöÑ„ÉªÊÇ†‰πÖ", prefer: "sharp" },
        { id: "java", n: 5, name: "„Ç∏„É£„Éê„Éã„Éº„Ç∫", intervals: [0, 1, 3, 7, 8], region: "„Ç§„É≥„Éâ„Éç„Ç∑„Ç¢", img: "„Ç¨„É†„É©„É≥", prefer: "flat" },
        { id: "whole", n: 6, name: "ÂÖ®Èü≥Èü≥Èöé", intervals: [0, 2, 4, 6, 8, 10], region: "‰ªè (Âç∞Ë±°Ê¥æ)", img: "Â§¢Âπª„ÉªÊñπÂêëÂñ™Â§±", prefer: "sharp" },
        { id: "mystic", n: 6, name: "Á•ûÁßòÈü≥Èöé", intervals: [0, 2, 4, 6, 9, 10], region: "„É≠„Ç∑„Ç¢", img: "„Çπ„ÇØ„É™„É£„Éº„Éì„É≥", prefer: "sharp" },
        { id: "blue", n: 6, name: "„Éñ„É´„Éº„Éé„Éº„Éà", intervals: [0, 3, 5, 6, 7, 10], region: "„Ç¢„É°„É™„Ç´", img: "ÈáéÊÄßÂë≥", prefer: "flat" },
        { id: "lydian", n: 7, name: "„É™„Éá„Ç£„Ç¢„É≥", intervals: [0, 2, 4, 6, 7, 9, 11], region: "Ê¨ßÂ∑û", img: "Á•ûË©±ÁöÑÂÖâ", prefer: "sharp" },
        { id: "mixo", n: 7, name: "„Éü„ÇØ„ÇΩ„É™„Éá„Ç£„Ç¢„É≥", intervals: [0, 2, 4, 5, 7, 9, 10], region: "Ê¨ßÂ∑û", img: "Á•ùÁ•≠„ÉªÈñãÊîæ", prefer: "flat" },
        { id: "phrygian", n: 7, name: "„Éï„É™„Ç∏„Ç¢„É≥", intervals: [0, 1, 3, 5, 7, 8, 10], region: "„Çπ„Éö„Ç§„É≥", img: "ÂÆøÂëΩ„ÉªÊÉÖÂøµ", prefer: "flat" },
        { id: "phrygian_dom", n: 7, name: "„Éï„É™„Ç∏„Ç¢„É≥Dom", intervals: [0, 1, 4, 5, 7, 8, 10], region: "„Ç®„Ç∏„Éó„Éà", img: "Á†ÇÊº†„ÉªÂ®ÅÂúß", prefer: "flat" },
        { id: "hungary", n: 7, name: "„Éè„É≥„Ç¨„É™„ÉºÁü≠", intervals: [0, 2, 3, 6, 7, 8, 11], region: "Êù±Ê¨ß", img: "ÁãÇÊ∞ó", prefer: "sharp" },
        { id: "messiaen2", n: 8, name: "„É°„Ç∑„Ç¢„É≥Á¨¨2", intervals: [0, 1, 3, 4, 6, 7, 9, 10], region: "Áèæ‰ª£Èü≥Ê•Ω", img: "ÂÆùÁü≥„ÉªÁ•ûÁßò", prefer: "flat" },
        { id: "messiaen7", n: 10, name: "„É°„Ç∑„Ç¢„É≥Á¨¨7", intervals: [0, 1, 2, 3, 5, 6, 7, 8, 9, 11], region: "Áèæ‰ª£Èü≥Ê•Ω", img: "„Ç´„Ç™„Çπ", prefer: "sharp" }
    ];

    const keySelect = document.getElementById('keySelect');
    const orderSelect = document.getElementById('orderSelect');
    const checkboxContainer = document.getElementById('checkboxContainer');

    notesFlat.forEach((n, i) => {
        const opt = document.createElement('option');
        opt.value = i; opt.textContent = n;
        keySelect.appendChild(opt);
    });

    scales.forEach(s => {
        const label = document.createElement('label');
        label.className = 'scale-checkbox';
        label.innerHTML = `<input type="checkbox" id="check_${s.id}" checked onchange="update()"> ${s.name}`;
        checkboxContainer.appendChild(label);
    });

    function checkAll(val) {
        scales.forEach(s => document.getElementById(`check_${s.id}`).checked = val);
        update();
    }

    function update() {
        const shift = parseInt(keySelect.value);
        const order = orderSelect.value;
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = "";
        
        const flatKeys = [1, 3, 5, 8, 10];
        const isFlatKey = flatKeys.includes(shift);

        scales.forEach(s => {
            const isChecked = document.getElementById(`check_${s.id}`).checked;
            if (!isChecked) return;

            const useFlat = (s.prefer === "flat") || (isFlatKey && s.prefer !== "sharp");
            const noteList = useFlat ? notesFlat : notesSharp;
            
            // ‰∏¶„Å≥Êõø„Åà„É≠„Ç∏„ÉÉ„ÇØ
            let displayIntervals = [...s.intervals];
            if (order === "tertial") {
                let tertial = [];
                let temp = [...s.intervals];
                let i = 0;
                while (temp.length > 0) {
                    tertial.push(temp[i]);
                    temp.splice(i, 1);
                    if (temp.length > 0) {
                        i = (i + 1) % temp.length; 
                    }
                }
                displayIntervals = tertial;
            }

            const notes = displayIntervals.map(i => noteList[(i + shift) % 12]).join(" ");

            tbody.innerHTML += `<tr>
                <td class="num-cell">${s.n}</td>
                <td style="font-weight:bold;">${s.name}</td>
                <td class="notes">${notes}</td>
                <td class="region">${s.region}</td>
                <td>${s.img}</td>
            </tr>`;
        });
    }

    update();
</script>
</body>
</html>
